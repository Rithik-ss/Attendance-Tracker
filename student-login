<!DOCTYPE html>
<html>
<head>
  <title>Student Login</title>
  <style>
    body {
      font-family: Arial;
      background: #f3e6ff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .login-box {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px gray;
      width: 300px;
    }
    input {
      display: block;
      margin: 10px 0;
      padding: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      padding: 10px;
      background: #6200ea;
      color: white;
      border: none;
      cursor: pointer;
      width: 100%;
    }
    .password-wrapper {
      position: relative;
    }
    .password-wrapper span {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="login-box">
    <h2>Student Login</h2>
    <input type="text" id="name" placeholder="Your Name" required>
    <input type="text" id="roll" placeholder="Roll Number" required pattern="[A-Za-z0-9]+" />

    <div class="password-wrapper">
      <input type="password" id="password" placeholder="Password" required>
      <span onclick="togglePassword()">üëÅÔ∏è</span>
    </div>

    <label>Upload Profile Photo:</label>
    <input type="file" id="photo" accept="image/*">
    <button onclick="login()">Login</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBtkza2N7BI9ULP_sbWXt2GhhGxl5in0Zg",
      authDomain: "reat-3d59e.firebaseapp.com",
      projectId: "reat-3d59e",
      storageBucket: "reat-3d59e.appspot.com",
      messagingSenderId: "360948191569",
      appId: "1:360948191569:web:cdca6f567a6b5607e3c370"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function togglePassword() {
      const pwd = document.getElementById("password");
      pwd.type = pwd.type === "password" ? "text" : "password";
    }
async function login() {
  const name = document.getElementById("name").value.trim();
  const roll = document.getElementById("roll").value.trim();
  const password = document.getElementById("password").value;
  const photoFile = document.getElementById("photo").files[0];

  if (!name || !roll || !password) {
    alert("Please fill all fields.");
    return;
  }

  // Enforce roll number and password must be same
  if (roll !== password) {
    alert("Roll number and password must be the same.");
    return;
  }

  try {
    const docRef = db.collection("students").doc(roll);
    const docSnap = await docRef.get();

    if (docSnap.exists) {
      const data = docSnap.data();

      if (data.password === password) {
        // ‚úÖ Login successful
        localStorage.setItem("studentName", data.name);
        localStorage.setItem("studentRoll", roll);

        if (photoFile) {
          const reader = new FileReader();
          reader.onload = function () {
            localStorage.setItem("studentPhoto", reader.result);
            window.location.href = "studentDashboard.html";
          };
          reader.readAsDataURL(photoFile);
        } else {
          localStorage.setItem("studentPhoto", "");
          window.location.href = "studentDashboard.html";
        }

      } else {
        alert("Incorrect password.");
      }

    } else {
      // üîê New user ‚Äì Register
      await docRef.set({ name, password }); // password is same as roll

      localStorage.setItem("studentName", name);
      localStorage.setItem("studentRoll", roll);

      if (photoFile) {
        const reader = new FileReader();
        reader.onload = function () {
          localStorage.setItem("studentPhoto", reader.result);
          window.location.href = "studentDashboard.html";
        };
        reader.readAsDataURL(photoFile);
      } else {
        localStorage.setItem("studentPhoto", "");
        window.location.href = "studentDashboard.html";
      }
    }

  } catch (err) {
    console.error("Login error:", err);
    alert("Error during login. Please check Firestore rules or console for details.");
  }
}

  </script>
</body>
</html>
